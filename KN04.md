# KN04 - Containers in Action & Orchestration

## Docker Image aufsetzen, in Registry ablegen und deployen - OCI: BASIC WORKFLOW

### 1) Teil-Challenge

Als erstes habe ich das "container-bootstrap" Repository geklont:

Danach habe ich in der main.css Datei die Hintergrundfarbe des Textes auf Goldgelb (#ebd63d) angepasst. Den alten image.png mit der neuen image-new.png ersetzt:
Und in der app.js Datei den Port auf 8091 geändert:

Dockerfile anpassen
Dann habe ich im Dockerfile den Port hinzugefügt:

# Web-App mit Content und mit Rückmeldung, welcher Container (ID) die Anfrage bearbeitet hat
FROM node:current-alpine

LABEL org.opencontainers.image.title="Hallo in der Containerwelt" \
      org.opencontainers.image.description="Web server-Content" \
      org.opencontainers.image.authors="@calisto"

# Erstelle das Directory im Container-Image für den App-Code
RUN mkdir -p /usr/src/app

# Kopiere App-code (.) ins /usr/src/app des Container-Images
COPY . /usr/src/app

# Setze das Working-Directory auf das eben erstellte Verzeichnis, in welchem der App-Code abgelegt wurde
WORKDIR /usr/src/app

# Installiert die dependencies von package.json
RUN npm install

# Kommando, um den Container auszuführen
ENTRYPOINT [ "node", "app.js" ]

EXPOSE 8091


OCI bauen
Danach konnte ich das Image bauen. Dafür habe ich folgender Befehl verwendet:

docker build -t registry.gitlab.com/martsorr/repository/webapp_martsorr_8091:1.0 .



Contianer Registry login
Mit dem folgenden Befehl habe ich mich auf der GitLab Registry eingeloggt:

docker login registry.gitlab.com


Dies hat nach mein GitLab Username und Access Token gefragt.

Images Pushen
Somit konnte ich die Image auf der container-registry pushen:

docker push registry.gitlab.com/martsorr/container-bootstrap/webapp_martsorr_8091:1.0



OCI Image starten
Jetzt kann ich die OCI Image auch starten:

docker container run -d --name container-webserver -p 8091:8091 registry.gitlab.com/martsorr/container-bootstrap/webapp_martsorr_8091:1.0


AWS Port erlauben
Da ich Port 8091 verwendet habe, muss ich dies auch auf AWS erlauben, damit ich darauf zugreifen kann:

Test
Mit einem docker ps prüfe ich ob der Container lauft:

Der Container lauft und ich kann in dem Browser über die URL http://34.229.147.110:8091/ (AWS Public IP) auf die Webapp gehen:

Da kann man auch das neue Bild und die ID des Containers sehen.
Container stoppen und löschen
Am Ende habe ich das Container gestoppt:

docker container stop container-webserver


Das Container gelöscht:

docker container rm container-webserver


Und die OCI Image gelöscht:

docker image rm a2bdbca64800


Neu Starten
Als test habe ich das Container neu gestartet:

docker container run -d --name container-webserver -p 8091:8091 registry.gitlab.com/martsorr/container-bootstrap/webapp_martsorr_8091:1.0


Da die Image nicht lokal existiert, hat es diese auf meiner continainer-bootstrap Repository verwendet:

Die Webapp hat dann die neue Contianer ID gezeigt:
